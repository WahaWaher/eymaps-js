/**
 * jQuery.eyMaps
 * Version: 1.0.1
 * Repo: https://github.com/WahaWaher/eymaps-js
 * Author: Sergey Kravchenko
 * Contacts: wahawaher@gmail.com
 * License: MIT
 */

!function(t){var e,i={api:"https://api-maps.yandex.ru/2.1/?lang=ru_RU",zoomAfter:"click",event:!1,placemarkDefaults:{},map:{center:[],zoom:5},placemark:[{geometry:[],properties:{},options:{}}]},a=function(t,e){this.it=t,this.init(e)},n=a.prototype;n.init=function(a){var n,o=this,r=o.it,s=t(r);!0!==o.inited&&(console.log("Метод: Init",arguments,o),o.defaults=t.extend(!0,{},i,t.fn.eyMaps.defaults),o.options=a||{},o.dataOptions=s.data("eymaps")||{},o.settings=n=t.extend(!0,{},o.defaults,o.options,o.dataOptions),o.nsid=e.getRndNum(1e4,99999),o.nspc="eym-"+o.nsid,o.mpid="eymaps-mid-"+o.nsid,o.map={},s.trigger("beforeInit.eym",[o.it,o]),s.addClass("eymaps"),s.attr("id")?o.mpid=s.attr("id"):s.attr("id",o.mpid),n.event?s.one(n.event+"."+o.nspc,function(){o.load.call(o)}):o.load.call(o),o.inited=!0,s.trigger("afterInit.eym",[o.it,o]))},n.load=function(){var e=this,i=(t(e.it),e.settings),a=t('script[src="'+i.api+'"]');a.length&&"object"==typeof ymaps?e.loadMAP():a.length&&"object"!=typeof ymaps?a.on("load",function(){e.loadMAP.call(e)}):e.loadAPI(i.api,function(){e.loadMAP.call(e)})},n.loadAPI=function(e,i){var a=this,n=(t(a.it),a.settings),o=t("<script/>").attr("src",e||n.api).get(0);document.body.appendChild(o),o.onload=function(){"function"==typeof i&&i()}},n.loadMAP=function(){var e=this,i=t(e.it),a=e.settings;null==e.it.firstChild&&ymaps.ready(function(){i.trigger("beforeLoad.eym",[e.it,e,e.map]),e.map=new ymaps.Map(e.mpid,a.map),a.zoomAfter&&(e.map.behaviors.disable("scrollZoom"),e.map.container._parentElement.addEventListener(a.zoomAfter,function(){e.map.behaviors.isEnabled("scrollZoom")||e.map.behaviors.enable("scrollZoom")})),"object"==typeof a.placemark[0].geometry&&2===a.placemark[0].geometry.length&&t.each(a.placemark,function(i,n){var o=new ymaps.Placemark(n.geometry,n.properties,t.extend({},a.placemarkDefaults,n.options));e.map.geoObjects.add(o)}),i.trigger("beforeLoad.eym",[e.it,e,e.map])})},n.destroy=function(){var e=this,i=t(e.it);e.inited&&(i.attr("id")==e.mpid&&i.attr("id").match(/-mid-/gim)&&i.removeAttr("id"),i.removeClass("eymaps").off(e.settings.event+"."+e.nspc).empty(),delete e.it.EyMaps)},n.reinit=function(e){var i=this,a=(i.it,"object"==typeof e&&0!=Object.keys(e).length?e:t.extend(!0,{},i.settings));i.destroy(),t(i.it).eyMaps(a)},e={getRndNum:function(t,e){return Math.round(t-.5+Math.random()*(e-t+1))}},t.fn.eyMaps=function(){function e(t,e,i){if(t[n]instanceof a&&e in t[n])return t[n][e].apply(t[n],Array.prototype.slice.call(i,1))}function i(t,e){if(!(t[n]instanceof a))return new a(t,e)}var n="EyMaps",o=arguments,r=o[0];return t.each(this,function(t,a){"object"==typeof r||void 0===r?a[n]=i(a,r):"init"===r||"reinit"===r?a[n]?e(a,r,o):a[n]=i(a,o[1]):e(a,r,o)}),this},t.fn.eyMaps.defaults=i}(jQuery);