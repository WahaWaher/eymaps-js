/**
 * jQuery.eyMaps
 * Version: 2.0.0
 * Repo: https://github.com/WahaWaher/eymaps-js
 * Author: Sergey Kravchenko
 * Contacts: wahawaher@gmail.com
 * License: MIT
 */

!function(t){var e,a={api:"https://api-maps.yandex.ru/2.1/?lang=ru_RU",zoomAfter:"click",event:!1,placemarkDefaults:{},map:{center:[],zoom:5},placemark:[{geometry:[],properties:{},options:{}}]},i=function(t,e){this.it=t,this.init(e)},n=i.prototype;n.init=function(i){var n,o=this,r=o.it,s=t(r);!0!==o.inited&&(o.defaults=t.extend(!0,{},a,t.fn.eyMaps.defaults),o.options=i||{},o.dataOptions=s.data("eymaps")||{},o.settings=n=t.extend(!0,{},o.defaults,o.options,o.dataOptions),o.nsid=e.getRndNum(1e4,99999),o.nspc="eym-"+o.nsid,o.mpid="eymaps-id-"+o.nsid,o.map={},s.trigger("beforeInit.eym",[o]),s.addClass("eymaps"),s.attr("id")?o.mpid=s.attr("id"):s.attr("id",o.mpid),n.event?s.one(n.event+"."+o.nspc,function(){o.load.call(o)}):o.load.call(o),o.inited=!0,s.trigger("afterInit.eym",[o]))},n.load=function(){var e=this,a=(t(e.it),e.settings),i=t('script[src="'+a.api+'"]');i.length&&"object"==typeof ymaps?e.loadMAP():i.length&&"object"!=typeof ymaps?i.on("load",function(){e.loadMAP.call(e)}):e.loadAPI(a.api,function(){e.loadMAP.call(e)})},n.loadAPI=function(e,a){var i=this,n=(t(i.it),i.settings),o=t("<script/>").attr("src",e||n.api).get(0);document.body.appendChild(o),o.onload=function(){"function"==typeof a&&a()}},n.loadMAP=function(){var e=this,a=t(e.it),i=e.settings;null==e.it.firstChild&&ymaps.ready(function(){a.trigger("beforeLoad.eym",[e]),e.map=new ymaps.Map(e.mpid,i.map),i.zoomAfter&&(e.map.behaviors.disable("scrollZoom"),e.map.container._parentElement.addEventListener(i.zoomAfter,function(){e.map.behaviors.isEnabled("scrollZoom")||e.map.behaviors.enable("scrollZoom")})),"object"==typeof i.placemark[0].geometry&&2===i.placemark[0].geometry.length&&t.each(i.placemark,function(a,n){var o=new ymaps.Placemark(n.geometry,n.properties,t.extend({},i.placemarkDefaults,n.options));e.map.geoObjects.add(o)}),a.trigger("afterLoad.eym",[e,e.map])})},n.destroy=function(){var e=this,a=t(e.it);e.inited&&(a.attr("id")==e.mpid&&a.attr("id").match(/eymaps\-id/gim)&&a.removeAttr("id"),a.removeClass("eymaps").off(e.settings.event+"."+e.nspc).empty(),delete e.it.EyMaps)},n.reinit=function(e){var a=this,i=(a.it,"object"==typeof e&&0!=Object.keys(e).length?e:t.extend(!0,{},a.settings));a.destroy(),t(a.it).eyMaps(i)},e={getRndNum:function(t,e){return Math.round(t-.5+Math.random()*(e-t+1))}},t.fn.eyMaps=function(){function e(t,e,a){if(t[n]instanceof i&&e in t[n])return t[n][e].apply(t[n],Array.prototype.slice.call(a,1))}function a(t,e){if(!(t[n]instanceof i))return new i(t,e)}var n="EyMaps",o=arguments,r=o[0];return t.each(this,function(t,i){"object"==typeof r||void 0===r?i[n]=a(i,r):"init"===r||"reinit"===r?i[n]?e(i,r,o):i[n]=a(i,o[1]):e(i,r,o)}),this},t.fn.eyMaps.defaults=a}(jQuery);